<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Consulta el precio de la luz por horas en Espa√±a. Descubre las horas m√°s baratas para ahorrar en tu factura el√©ctrica.">
  <meta name="keywords" content="precio luz, PVPC, electricidad Espa√±a, horas baratas, ahorro energ√≠a">
  <title>LuzF√°cil - Precio de la Luz Hoy y Ma√±ana | Espa√±a</title>
  
  <meta property="og:title" content="LuzF√°cil - Precio de la Luz en Espa√±a">
  <meta property="og:description" content="Consulta las horas m√°s baratas de electricidad y ahorra en tu factura">
  <meta property="og:type" content="website">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px 20px;
      text-align: center;
    }
    
    .header h1 { font-size: 2.2em; font-weight: 700; margin-bottom: 8px; }
    .header .tagline { font-size: 1.1em; opacity: 0.9; }
    
    .date-display {
      background: rgba(255,255,255,0.2);
      display: inline-block;
      padding: 10px 24px;
      border-radius: 50px;
      margin-top: 20px;
      font-weight: 600;
      font-size: 1.1em;
    }
    
    .date-label {
      background: #4caf50;
      color: white;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.75em;
      margin-right: 8px;
      text-transform: uppercase;
    }
    
    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    
    .card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    
    .card h2 {
      font-size: 1.3em;
      margin-bottom: 20px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    
    @media (max-width: 500px) {
      .stats-grid { grid-template-columns: 1fr; }
    }
    
    .stat-box {
      padding: 20px 16px;
      border-radius: 12px;
      text-align: center;
    }
    
    .stat-box.green { background: #e8f5e9; }
    .stat-box.red { background: #ffebee; }
    .stat-box.blue { background: #e3f2fd; }
    
    .stat-value { font-size: 1.6em; font-weight: 700; }
    .stat-box.green .stat-value { color: #2e7d32; }
    .stat-box.red .stat-value { color: #c62828; }
    .stat-box.blue .stat-value { color: #1565c0; }
    .stat-label { font-size: 0.85em; color: #666; margin-top: 4px; }
    
    .hours-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    @media (max-width: 600px) {
      .hours-grid { grid-template-columns: 1fr; }
    }
    
    .hours-section h3 { font-size: 1em; margin-bottom: 12px; color: #555; }
    
    .hour-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      border-radius: 10px;
      margin-bottom: 8px;
      font-size: 0.95em;
    }
    
    .hour-item.best { background: #e8f5e9; border-left: 4px solid #4caf50; }
    .hour-item.worst { background: #ffebee; border-left: 4px solid #f44336; }
    .hour-time { font-weight: 600; }
    .hour-price { color: #666; }
    
    .chart-container { overflow-x: auto; padding: 10px 0; }
    
    .price-bars {
      display: flex;
      align-items: flex-end;
      height: 180px;
      gap: 4px;
      min-width: 500px;
      padding-bottom: 25px;
      border-bottom: 2px solid #e0e0e0;
    }
    
    .bar-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .bar {
      width: 100%;
      max-width: 24px;
      border-radius: 4px 4px 0 0;
      cursor: pointer;
    }
    
    .bar:hover { opacity: 0.8; }
    .bar.cheap { background: linear-gradient(to top, #43a047, #66bb6a); }
    .bar.moderate { background: linear-gradient(to top, #fb8c00, #ffa726); }
    .bar.expensive { background: linear-gradient(to top, #e53935, #ef5350); }
    .bar-hour { font-size: 10px; color: #888; margin-top: 6px; }
    
    /* AD BANNER STYLES */
    .ad-banner {
      background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
      color: white;
      text-decoration: none;
      display: block;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .ad-banner:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
    }
    
    .ad-banner .ad-label {
      font-size: 0.7em;
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }
    
    .ad-banner h3 { font-size: 1.3em; margin-bottom: 6px; }
    .ad-banner p { font-size: 0.95em; opacity: 0.95; }
    
    .inline-ad {
      background: #f0f4ff;
      border: 2px dashed #667eea;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
    }
    
    .inline-ad a {
      color: #667eea;
      font-weight: 600;
      text-decoration: none;
    }
    
    .inline-ad a:hover { text-decoration: underline; }
    
    /* NOTIFICATION SIGNUP */
    .notification-section {
      background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      color: white;
      border-radius: 16px;
      padding: 30px 24px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .notification-section h2 {
      color: white;
      justify-content: center;
      margin-bottom: 8px;
    }
    
    .notification-section > p {
      opacity: 0.95;
      margin-bottom: 24px;
    }
    
    .notification-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 24px;
    }
    
    .notif-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: white;
      text-decoration: none;
      padding: 14px 24px;
      border-radius: 10px;
      font-weight: 600;
      transition: transform 0.2s;
    }
    
    .notif-btn:hover { transform: translateY(-2px); }
    .notif-btn.telegram { background: #0088cc; }
    .notif-btn.whatsapp { background: #25D366; }
    
    .email-signup { max-width: 400px; margin: 0 auto; }
    .email-signup p { font-size: 0.9em; opacity: 0.9; margin-bottom: 12px; }
    
    .email-form { display: flex; gap: 8px; }
    
    .email-form input {
      flex: 1;
      padding: 14px 16px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
    }
    
    .email-form button {
      background: #333;
      color: white;
      border: none;
      padding: 14px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    
    .email-form button:hover { background: #555; }
    
    @media (max-width: 500px) {
      .email-form { flex-direction: column; }
    }
    
    .success-message {
      background: rgba(255,255,255,0.2);
      padding: 12px 20px;
      border-radius: 8px;
      margin-top: 12px;
      display: none;
    }
    
    .success-message.show { display: block; }
    
    /* AFFILIATE SECTION */
    .affiliate-section {
      background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
      color: white;
      border-radius: 16px;
      padding: 30px 24px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .affiliate-section h2 { color: white; justify-content: center; margin-bottom: 12px; }
    .affiliate-section > p { opacity: 0.9; margin-bottom: 24px; font-size: 1.05em; }
    
    .affiliate-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 400px;
      margin: 0 auto;
    }
    
    .affiliate-btn {
      display: block;
      background: white;
      color: #1a237e;
      text-decoration: none;
      padding: 16px 24px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 1em;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .affiliate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    
    .affiliate-btn span {
      font-size: 0.85em;
      font-weight: 400;
      color: #666;
      display: block;
      margin-top: 4px;
    }
    
    /* TIPS */
    .tip-item {
      display: flex;
      gap: 16px;
      padding: 16px;
      background: #f8f9fa;
      border-radius: 12px;
      margin-bottom: 12px;
    }
    
    .tip-icon { font-size: 1.5em; }
    .tip-content h4 { font-size: 1em; margin-bottom: 4px; color: #333; }
    .tip-content p { font-size: 0.9em; color: #666; }
    
    .tip-highlight {
      background: #e8f5e9;
      color: #2e7d32;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 600;
    }
    
    /* TABLE */
    .price-table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
    
    .price-table th {
      background: #667eea;
      color: white;
      padding: 12px 8px;
      text-align: center;
      font-weight: 600;
    }
    
    .price-table td {
      padding: 10px 8px;
      text-align: center;
      border-bottom: 1px solid #eee;
    }
    
    .price-table tr:hover { background: #f5f5f5; }
    
    /* FOOTER */
    .footer {
      text-align: center;
      padding: 30px 20px;
      color: #888;
      font-size: 0.85em;
    }
    
    .footer a { color: #667eea; }
    
    /* COOKIE BANNER */
    .cookie-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #333;
      color: white;
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      z-index: 1000;
    }
    
    .cookie-banner.hidden { display: none; }
    .cookie-banner p { font-size: 0.9em; margin: 0; }
    
    .cookie-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      white-space: nowrap;
    }
    
    @media (max-width: 600px) {
      .cookie-banner { flex-direction: column; text-align: center; }
    }
  </style>
</head>
<body>
  
  <header class="header">
    <h1>‚ö° LuzF√°cil</h1>
    <p class="tagline">El precio de la luz en Espa√±a, f√°cil y claro</p>
    <div class="date-display">
      <span class="date-label" id="date-label">HOY</span>
      <span id="date-text">Cargando...</span>
    </div>
  </header>
  
  <div class="container">
    
    <!-- STATS -->
    <div class="card">
      <h2>üìä Resumen del D√≠a</h2>
      <div class="stats-grid">
        <div class="stat-box green">
          <div class="stat-value" id="min-price">--</div>
          <div class="stat-label">Precio m√≠nimo</div>
        </div>
        <div class="stat-box red">
          <div class="stat-value" id="max-price">--</div>
          <div class="stat-label">Precio m√°ximo</div>
        </div>
        <div class="stat-box blue">
          <div class="stat-value" id="avg-price">--</div>
          <div class="stat-label">Precio medio</div>
        </div>
      </div>
    </div>
    
    <!-- CHART -->
    <div class="card">
      <h2>üìà Precios por Hora</h2>
      <div class="chart-container">
        <div class="price-bars" id="price-chart"></div>
      </div>
    </div>
    
    <!-- BEST & WORST -->
    <div class="card">
      <h2>‚è∞ Mejores y Peores Horas</h2>
      <div class="hours-grid">
        <div class="hours-section">
          <h3>üíö Horas m√°s baratas</h3>
          <div id="best-hours"></div>
        </div>
        <div class="hours-section">
          <h3>üî¥ Horas m√°s caras</h3>
          <div id="worst-hours"></div>
        </div>
      </div>
    </div>
    
    <!-- NOTIFICATION SIGNUP -->
    <div class="notification-section">
      <h2>üîî Recibe los precios cada d√≠a</h2>
      <p>Te enviamos las horas m√°s baratas todas las tardes</p>
      
      <div class="notification-buttons">
        <a href="https://t.me/YOUR_TELEGRAM_CHANNEL" target="_blank" rel="noopener" class="notif-btn telegram">
          üì± √önete en Telegram
        </a>
        <a href="https://whatsapp.com/channel/0029Vb6uX5gAYlUHBAL11R20" target="_blank" rel="noopener" class="notif-btn whatsapp">
          üí¨ Canal de WhatsApp
        </a>
      </div>
      
      <div class="email-signup">
        <p>O recibe un email diario:</p>
        <form class="email-form" id="email-form" onsubmit="handleEmailSubmit(event)">
          <input type="email" placeholder="tu@email.com" required id="email-input">
          <button type="submit">Suscribir</button>
        </form>
        <div class="success-message" id="success-message">
          ‚úì ¬°Gracias! Te hemos a√±adido a la lista.
        </div>
      </div>
    </div>
    
    <!-- TIPS -->
    <div class="card">
      <h2>üí° Consejos para Hoy</h2>
      <div id="tips-container"></div>
    </div>
    
    <!-- AFFILIATE SECTION -->
    <div class="affiliate-section">
      <h2>üí∞ ¬øEst√°s pagando de m√°s?</h2>
      <p>Los precios PVPC var√≠an mucho. Compara tarifas y encuentra una mejor.</p>
      <div class="affiliate-buttons">
        <a href="https://selectra.es/energia" target="_blank" rel="noopener" class="affiliate-btn">
          Comparar en Selectra
          <span>Compara luz y gas gratis</span>
        </a>
        <a href="https://www.rastreator.com/luz-y-gas.html" target="_blank" rel="noopener" class="affiliate-btn">
          Comparar en Rastreator
          <span>Encuentra la tarifa m√°s barata</span>
        </a>
      </div>
    </div>
    
    <!-- FULL TABLE -->
    <div class="card">
      <h2>üìã Tabla Completa de Precios</h2>
      <table class="price-table">
        <thead>
          <tr><th>Hora</th><th>‚Ç¨/kWh</th><th>‚Ç¨/MWh</th><th>Nivel</th></tr>
        </thead>
        <tbody id="price-table-body"></tbody>
      </table>
    </div>
    
    <!-- BOTTOM AD -->
    <a href="https://www.rastreator.com/luz-y-gas.html" target="_blank" rel="noopener" class="ad-banner" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);">
      <div class="ad-label">Publicidad</div>
      <h3>Compara y ahorra en luz y gas</h3>
      <p>Miles de espa√±oles ya han encontrado una tarifa mejor ‚Üí</p>
    </a>
    
  </div>
  
  <footer class="footer">
    <p>Datos de <a href="https://www.esios.ree.es" target="_blank">Red El√©ctrica de Espa√±a (ESIOS)</a></p>
    <p>Precios para tarifa PVPC en la Pen√≠nsula ¬∑ Actualizado cada d√≠a a las 20:15</p>
    
    <!-- Admin tool for quick WhatsApp posting -->
    <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 10px; display: inline-block;">
      <button onclick="copyForWhatsApp()" style="background: #25D366; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1em;">
        üìã Copiar resumen para WhatsApp
      </button>
      <div id="copy-status" style="margin-top: 8px; font-size: 0.85em; color: #2e7d32;"></div>
    </div>
    
    <p style="margin-top: 12px;">¬© 2025 LuzF√°cil</p>
  </footer>
  
  <div class="cookie-banner" id="cookie-banner">
    <p>Usamos cookies para mejorar tu experiencia. Al continuar, aceptas su uso.</p>
    <button class="cookie-btn" onclick="acceptCookies()">Aceptar</button>
  </div>
  
  <script>
    // PRICE DATA - Updated by update_prices.R
    const priceData = [
      { hour: 0, price: 144.4 },
      { hour: 1, price: 126.0 },
      { hour: 2, price: 114.6 },
      { hour: 3, price: 113.0 },
      { hour: 4, price: 111.0 },
      { hour: 5, price: 109.6 },
      { hour: 6, price: 108.5 },
      { hour: 7, price: 111.7 },
      { hour: 8, price: 120.7 },
      { hour: 9, price: 110.7 },
      { hour: 10, price: 47.9 },
      { hour: 11, price: 34.2 },
      { hour: 12, price: 33.0 },
      { hour: 13, price: 32.9 },
      { hour: 14, price: 33.1 },
      { hour: 15, price: 33.1 },
      { hour: 16, price: 57.7 },
      { hour: 17, price: 140.1 },
      { hour: 18, price: 157.9 },
      { hour: 19, price: 166.9 },
      { hour: 20, price: 170.9 },
      { hour: 21, price: 166.1 },
      { hour: 22, price: 159.4 },
      { hour: 23, price: 146.9 }
    ];
    
    function getSpainTime() {
      return new Date(new Date().toLocaleString("en-US", {timeZone: "Europe/Madrid"}));
    }
    
    function getSmartDate() {
      const spainTime = getSpainTime();
      const decimal = spainTime.getHours() + spainTime.getMinutes() / 60;
      let targetDate = new Date(spainTime);
      let label = "HOY";
      if (decimal >= 20.25) {
        targetDate.setDate(targetDate.getDate() + 1);
        label = "MA√ëANA";
      }
      return { date: targetDate, label: label };
    }
    
    function formatPrice(priceMwh) {
      return "‚Ç¨" + (priceMwh / 1000).toFixed(4);
    }
    
    function formatHour(hour) {
      return hour.toString().padStart(2, '0') + ":00";
    }
    
    function categorize(price, avg) {
      if (price <= avg * 0.85) return 'cheap';
      if (price >= avg * 1.15) return 'expensive';
      return 'moderate';
    }
    
    // SMART RECOMMENDATIONS - Find cheapest hour within a time window
    function findCheapestInWindow(prices, startHour, endHour) {
      let validHours = prices.filter(p => {
        if (startHour < endHour) {
          return p.hour >= startHour && p.hour < endHour;
        } else {
          // Handles overnight windows like 00:00-07:00
          return p.hour >= startHour || p.hour < endHour;
        }
      });
      
      if (validHours.length === 0) return null;
      return validHours.reduce((min, p) => p.price < min.price ? p : min);
    }
    
    // Find best consecutive hours for EV charging (e.g., 3-4 hours)
    function findCheapestWindow(prices, startHour, endHour, duration) {
      let validHours = [];
      
      // Build array of valid hours
      for (let h = 0; h < 24; h++) {
        if (startHour < endHour) {
          if (h >= startHour && h < endHour) validHours.push(prices[h]);
        } else {
          if (h >= startHour || h < endHour) validHours.push(prices[h]);
        }
      }
      
      if (validHours.length < duration) return null;
      
      // Find cheapest consecutive block
      let bestStart = 0;
      let bestAvg = Infinity;
      
      for (let i = 0; i <= validHours.length - duration; i++) {
        let sum = 0;
        for (let j = 0; j < duration; j++) {
          sum += validHours[i + j].price;
        }
        let avg = sum / duration;
        if (avg < bestAvg) {
          bestAvg = avg;
          bestStart = i;
        }
      }
      
      return {
        startHour: validHours[bestStart].hour,
        endHour: validHours[bestStart + duration - 1].hour + 1,
        avgPrice: bestAvg
      };
    }
    
    function renderPage() {
      const smartDate = getSmartDate();
      const avgPrice = priceData.reduce((sum, p) => sum + p.price, 0) / priceData.length;
      const minPrice = Math.min(...priceData.map(p => p.price));
      const maxPrice = Math.max(...priceData.map(p => p.price));
      
      priceData.forEach(p => { p.category = categorize(p.price, avgPrice); });
      
      const sorted = [...priceData].sort((a, b) => a.price - b.price);
      const cheapest = sorted.slice(0, 6);
      const expensive = sorted.slice(-6).reverse();
      
      document.getElementById('date-label').textContent = smartDate.label;
      document.getElementById('date-text').textContent = smartDate.date.toLocaleDateString('es-ES', {
        weekday: 'long', day: 'numeric', month: 'long', year: 'numeric'
      });
      
      document.getElementById('min-price').textContent = formatPrice(minPrice);
      document.getElementById('max-price').textContent = formatPrice(maxPrice);
      document.getElementById('avg-price').textContent = formatPrice(avgPrice);
      
      document.getElementById('price-chart').innerHTML = priceData.map(p => {
        const height = (p.price / maxPrice) * 140;
        return `<div class="bar-wrapper"><div class="bar ${p.category}" style="height:${height}px" title="${formatHour(p.hour)}: ${formatPrice(p.price)}/kWh"></div><div class="bar-hour">${p.hour}</div></div>`;
      }).join('');
      
      document.getElementById('best-hours').innerHTML = cheapest.map(p => `
        <div class="hour-item best"><span class="hour-time">${formatHour(p.hour)}</span><span class="hour-price">${formatPrice(p.price)}/kWh</span></div>
      `).join('');
      
      document.getElementById('worst-hours').innerHTML = expensive.map(p => `
        <div class="hour-item worst"><span class="hour-time">${formatHour(p.hour)}</span><span class="hour-price">${formatPrice(p.price)}/kWh</span></div>
      `).join('');
      
      // SMART RECOMMENDATIONS based on realistic time windows
      const washer = findCheapestInWindow(priceData, 8, 22);      // 08:00-22:00
      const dishwasher = findCheapestInWindow(priceData, 14, 24); // 14:00-24:00
      const evCharging = findCheapestWindow(priceData, 0, 7, 4);  // 00:00-07:00, 4 hours
      const peakHours = priceData.filter(p => p.hour >= 18 && p.hour <= 21);
      const peakExpensive = peakHours.reduce((max, p) => p.price > max.price ? p : max);
      
      document.getElementById('tips-container').innerHTML = `
        <div class="tip-item">
          <div class="tip-icon">üß∫</div>
          <div class="tip-content">
            <h4>Lavadora</h4>
            <p>Mejor hora (08:00-22:00): <span class="tip-highlight">${formatHour(washer.hour)}</span> a ${formatPrice(washer.price)}/kWh</p>
          </div>
        </div>
        <div class="tip-item">
          <div class="tip-icon">üçΩÔ∏è</div>
          <div class="tip-content">
            <h4>Lavavajillas</h4>
            <p>Ponlo despu√©s de cenar: <span class="tip-highlight">${formatHour(dishwasher.hour)}</span> a ${formatPrice(dishwasher.price)}/kWh</p>
          </div>
        </div>
        <div class="tip-item">
          <div class="tip-icon">üöó</div>
          <div class="tip-content">
            <h4>Carga del coche el√©ctrico</h4>
            <p>Programa de <span class="tip-highlight">${formatHour(evCharging.startHour)} a ${formatHour(evCharging.endHour)}</span> (4h m√°s baratas de la noche)</p>
          </div>
        </div>
        <div class="tip-item">
          <div class="tip-icon">‚ö†Ô∏è</div>
          <div class="tip-content">
            <h4>Hora punta: evita las ${formatHour(peakExpensive.hour)}</h4>
            <p>Es la hora m√°s cara de la tarde/noche (${formatPrice(peakExpensive.price)}/kWh). Intenta no usar electrodom√©sticos grandes.</p>
          </div>
        </div>
      `;
      
      document.getElementById('price-table-body').innerHTML = priceData.map(p => {
        const bg = p.category === 'cheap' ? '#e8f5e9' : p.category === 'expensive' ? '#ffebee' : '#fff9c4';
        const emoji = p.category === 'cheap' ? 'üíö' : p.category === 'expensive' ? 'üî¥' : 'üü°';
        return `<tr style="background:${bg}"><td><strong>${formatHour(p.hour)}</strong></td><td>${formatPrice(p.price)}</td><td>‚Ç¨${p.price.toFixed(2)}</td><td>${emoji}</td></tr>`;
      }).join('');
    }
    
    function handleEmailSubmit(event) {
      event.preventDefault();
      const email = document.getElementById('email-input').value;
      // Store locally for now - connect to real service later
      let subs = JSON.parse(localStorage.getItem('subscribers') || '[]');
      subs.push({ email: email, date: new Date().toISOString() });
      localStorage.setItem('subscribers', JSON.stringify(subs));
      document.getElementById('email-form').style.display = 'none';
      document.getElementById('success-message').classList.add('show');
    }
    
    function acceptCookies() {
      localStorage.setItem('cookies_accepted', 'true');
      document.getElementById('cookie-banner').classList.add('hidden');
    }
    
    if (localStorage.getItem('cookies_accepted')) {
      document.getElementById('cookie-banner').classList.add('hidden');
    }
    
    // Generate WhatsApp message and copy to clipboard
    function copyForWhatsApp() {
      const smartDate = getSmartDate();
      const sorted = [...priceData].sort((a, b) => a.price - b.price);
      const cheapest = sorted.slice(0, 3);
      const expensive = sorted.slice(-3).reverse();
      
      // Smart recommendations
      const washer = priceData.filter(p => p.hour >= 8 && p.hour < 22)
                              .reduce((min, p) => p.price < min.price ? p : min);
      
      const dateStr = smartDate.date.toLocaleDateString('es-ES', {
        weekday: 'long', day: 'numeric', month: 'long'
      });
      
      const message = `‚ö° *LuzF√°cil - ${smartDate.label}*
üìÖ ${dateStr}

üíö *Horas m√°s baratas:*
${cheapest.map(p => `‚Ä¢ ${p.hour.toString().padStart(2,'0')}:00 ‚Üí ‚Ç¨${(p.price/1000).toFixed(4)}/kWh`).join('\n')}

üî¥ *Horas m√°s caras:*
${expensive.map(p => `‚Ä¢ ${p.hour.toString().padStart(2,'0')}:00 ‚Üí ‚Ç¨${(p.price/1000).toFixed(4)}/kWh`).join('\n')}

üß∫ *Lavadora:* Mejor a las ${washer.hour.toString().padStart(2,'0')}:00

üåê M√°s info: plc105226-byte.github.io/luzfacil`;

      navigator.clipboard.writeText(message).then(() => {
        document.getElementById('copy-status').textContent = '‚úì ¬°Copiado! P√©galo en WhatsApp';
        setTimeout(() => {
          document.getElementById('copy-status').textContent = '';
        }, 3000);
      });
    }
    
    renderPage();
  </script>
  
</body>
</html>
